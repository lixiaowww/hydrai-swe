# 2. 功能规范文档 (Functional Specification Document - FSD)

## 2.1 数据服务功能

*   **1.1 描述:** 系统应能通过API提供历史和预测的积雪等效水深（SWE）数据，以及派生的径流和洪水风险数据。
*   **1.2 用户需求:** 数据应以多种格式提供，包括GRIB2, GeoTIFF, CSV, 和 JSON，并与常见的GIS软件和风险分析工具兼容。
*   **1.3 功能要求:**
    *   **1.3.1:** 每日定时（例如，UTC 06:00）发布数据产品。
    *   **1.3.2:** 支持通过REST API和FTP服务访问数据。
    *   **1.3.3:** 实时处理的数据的延迟应在8小时内。
    *   **1.3.4:** 将所有空间数据重新投影到统一的地理空间参考系统（例如，UTM投影，1km分辨率）。
    *   **1.3.5:** 建立数据归档和检索/回填功能。

## 2.2 积雪等效水深 (SWE) 估算模型功能

*   **2.1 描述:** 系统应使用机器学习模型，结合多种数据源，生成每日的SWE估算。
*   **2.2 用户需求:** 研究人员需要能够查看和下载不同格式的SWE地图，以便进行验证和进一步分析。
*   **2.3 功能要求:**
    *   **2.3.1:** 模型应能处理多种输入数据，例如MODIS, Sentinel-2等。
    *   **2.3.2:** 模型应能处理缺失数据和异常值。
    *   **2.3.3:** 模型输出应为GeoTIFF格式，每个像素值代表该网格单元的SWE（单位：毫米）。
    *   **2.3.4:** 每日定时运行模型，生成最新的SWE估算图。
    *   **2.3.5:** 提供一个API端点，允许用户查询特定位置和日期的SWE值。

## 2.3 径流预测功能

*   **3.1 描述:** 系统应基于SWE数据和水文模型，预测未来7-14天的径流。
*   **3.2 用户需求:** 水文模型研究员和风险管理分析师需要获取未来一段时间内的径流预测值，以支持决策。
*   **3.3 功能要求:**
    *   **3.3.1:** 模型应能预测未来72小时的逐小时径流和未来7天的每日径流。
    *   **3.3.2:** 模型应能为5个以上的水文站点（例如，Emerson, Winnipeg）生成径流预测。
    *   **3.3.3:** 模型输出应为JSON格式，包括每个时间点的预测中位数、5%和95%置信区间。
    *   **3.3.4:** 每日定时运行模型，生成最新的径流预测。

## 2.4 API和数据服务

*   **4.1 描述:** 提供一个RESTful API，允许用户以编程方式访问模型输出。
*   **4.2 用户需求:** 用户需要一个有详细文档的API，以便将数据集成到他们自己的工作流程和GIS应用程序中。
*   **4.3 功能要求:**
    *   **4.3.1:** API应有密钥认证机制。
    *   **4.3.2:** 提供以下API端点：
        *   `GET /api/v1/swe`: 查询特定区域和日期的SWE栅格数据。
        *   `GET /api/v1/runoff-forecast`: 查询特定水文站点的径流预测。
        *   `GET /api/v1/risk-score`: （未来功能）查询特定区域的洪水风险评分。
    *   **4.3.3:** 提供交互式的API文档（例如，Swagger/OpenAPI）。
