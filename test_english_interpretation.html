<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test English Interpretation System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .interpretation-card { margin: 15px 0; }
        .test-button { margin: 5px; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">ðŸŒŠ English Interpretation System Test</h1>
        
        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle"></i> Test the Professional Hydrology Interpretation System</h5>
                    <p>This page tests the new English-only interpretation system that replaces all Chinese hardcoded interpretations.</p>
                </div>
            </div>
        </div>

        <!-- Test Section 1: Trend Analysis -->
        <div class="test-section">
            <h3><i class="fas fa-chart-line text-primary"></i> Test 1: Trend Analysis Interpretation</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Input Data:</h5>
                    <ul>
                        <li>Trend Data: [50, 55, 60, 65, 70] (increasing trend)</li>
                        <li>Seasonal Data: [10, 15, 20, 15, 10]</li>
                        <li>Anomaly Score: 1.5</li>
                        <li>Volatility: 8.5</li>
                        <li>Trend Strength: 25</li>
                    </ul>
                    <button class="btn btn-primary test-button" onclick="testTrendAnalysis()">
                        Test Trend Analysis
                    </button>
                </div>
                <div class="col-md-6">
                    <div id="trend-result"></div>
                </div>
            </div>
        </div>

        <!-- Test Section 2: Seasonal Patterns -->
        <div class="test-section">
            <h3><i class="fas fa-snowflake text-info"></i> Test 2: Seasonal Pattern Interpretation</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Input Data:</h5>
                    <ul>
                        <li>Trend Data: [30, 35, 40, 35, 30]</li>
                        <li>Seasonal Data: [25, 30, 35, 30, 25] (strong seasonal pattern)</li>
                        <li>Anomaly Score: 0.8</li>
                        <li>Volatility: 5.2</li>
                        <li>Trend Strength: 15</li>
                    </ul>
                    <button class="btn btn-info test-button" onclick="testSeasonalPatterns()">
                        Test Seasonal Patterns
                    </button>
                </div>
                <div class="col-md-6">
                    <div id="seasonal-result"></div>
                </div>
            </div>
        </div>

        <!-- Test Section 3: Anomaly Detection -->
        <div class="test-section">
            <h3><i class="fas fa-exclamation-triangle text-warning"></i> Test 3: Anomaly Detection Interpretation</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Input Data:</h5>
                    <ul>
                        <li>Trend Data: [40, 42, 45, 80, 85] (extreme anomaly)</li>
                        <li>Seasonal Data: [5, 8, 10, 8, 5]</li>
                        <li>Anomaly Score: 2.8 (extreme)</li>
                        <li>Volatility: 20.5</li>
                        <li>Trend Strength: 50</li>
                    </ul>
                    <button class="btn btn-warning test-button" onclick="testAnomalyDetection()">
                        Test Anomaly Detection
                    </button>
                </div>
                <div class="col-md-6">
                    <div id="anomaly-result"></div>
                </div>
            </div>
        </div>

        <!-- Test Section 4: Stable Patterns -->
        <div class="test-section">
            <h3><i class="fas fa-chart-bar text-success"></i> Test 4: Stable Pattern Interpretation</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Input Data:</h5>
                    <ul>
                        <li>Trend Data: [45, 46, 47, 48, 49] (stable trend)</li>
                        <li>Seasonal Data: [2, 3, 2, 3, 2] (weak seasonal)</li>
                        <li>Anomaly Score: 0.3</li>
                        <li>Volatility: 2.1</li>
                        <li>Trend Strength: 8</li>
                    </ul>
                    <button class="btn btn-success test-button" onclick="testStablePatterns()">
                        Test Stable Patterns
                    </button>
                </div>
                <div class="col-md-6">
                    <div id="stable-result"></div>
                </div>
            </div>
        </div>

        <!-- Test Section 5: Decreasing Trend -->
        <div class="test-section">
            <h3><i class="fas fa-arrow-down text-danger"></i> Test 5: Decreasing Trend Interpretation</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Input Data:</h5>
                    <ul>
                        <li>Trend Data: [60, 58, 55, 52, 48] (decreasing trend)</li>
                        <li>Seasonal Data: [8, 10, 12, 10, 8]</li>
                        <li>Anomaly Score: -0.5</li>
                        <li>Volatility: 6.8</li>
                        <li>Trend Strength: 22</li>
                    </ul>
                    <button class="btn btn-danger test-button" onclick="testDecreasingTrend()">
                        Test Decreasing Trend
                    </button>
                </div>
                <div class="col-md-6">
                    <div id="decreasing-result"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Interpretation System - English Only
        // Integrates with Hydrology Knowledge Base for professional analysis
        
        // Professional interpretation templates
        const interpretationTemplates = {
            trend_analysis: {
                strong_increasing: {
                    title: "Strong Increasing Trend in SWE",
                    description: "Strong increasing trend in SWE indicates significant accumulation patterns that may reflect climate change impacts or natural variability cycles.",
                    implications: [
                        "Potential for increased spring flood risk",
                        "Enhanced water storage for summer months",
                        "Possible climate change signal",
                        "Need for updated flood protection standards"
                    ]
                },
                moderate_increasing: {
                    title: "Moderate Increasing Trend in SWE",
                    description: "Moderate increasing trend suggests gradual changes in winter precipitation patterns or snow retention.",
                    implications: [
                        "Slight increase in flood risk",
                        "Improved water resource availability",
                        "Monitoring recommended for trend continuation"
                    ]
                },
                stable: {
                    title: "Stable SWE Patterns",
                    description: "Stable SWE patterns indicate consistent winter climate conditions and predictable hydrological behavior.",
                    implications: [
                        "Reliable flood forecasting possible",
                        "Consistent water resource planning",
                        "Existing infrastructure adequate"
                    ]
                },
                decreasing: {
                    title: "Decreasing SWE Trend",
                    description: "Decreasing SWE trend may indicate climate change impacts, reduced winter precipitation, or earlier melt onset.",
                    implications: [
                        "Reduced flood risk but potential drought concerns",
                        "Earlier spring runoff timing",
                        "Possible water resource challenges",
                        "Need for adaptation strategies"
                    ]
                }
            },
            
            seasonal_patterns: {
                early_peak: {
                    title: "Early Peak SWE Pattern",
                    description: "Early peak SWE suggests rapid winter accumulation followed by early melt onset.",
                    implications: [
                        "Earlier spring flood risk",
                        "Extended growing season potential",
                        "Reduced summer water availability",
                        "Altered ecosystem timing"
                    ]
                },
                late_peak: {
                    title: "Late Peak SWE Pattern",
                    description: "Late peak SWE indicates prolonged winter conditions with delayed melt onset.",
                    implications: [
                        "Delayed spring flood risk",
                        "Compressed growing season",
                        "Extended winter recreation opportunities",
                        "Potential for rapid melt events"
                    ]
                },
                double_peak: {
                    title: "Double Peak SWE Pattern",
                    description: "Double peak pattern suggests complex winter weather with multiple accumulation and melt cycles.",
                    implications: [
                        "Multiple flood risk periods",
                        "Complex forecasting requirements",
                        "Variable water availability",
                        "Need for adaptive management"
                    ]
                }
            },
            
            anomaly_assessment: {
                extreme_high: {
                    title: "Extremely High SWE Values",
                    description: "Extremely high SWE values represent significant departure from normal conditions.",
                    causes: [
                        "Exceptional winter precipitation",
                        "Cold temperatures limiting melt",
                        "Atmospheric river events",
                        "Climate change impacts"
                    ],
                    risks: [
                        "High flood potential",
                        "Infrastructure stress",
                        "Emergency response needs",
                        "Economic impacts"
                    ]
                },
                extreme_low: {
                    title: "Extremely Low SWE Values",
                    description: "Extremely low SWE values indicate drought conditions or unusual winter weather.",
                    causes: [
                        "Below-normal precipitation",
                        "Early melt onset",
                        "Warm winter temperatures",
                        "Climate change trends"
                    ],
                    risks: [
                        "Reduced water availability",
                        "Agricultural impacts",
                        "Ecosystem stress",
                        "Economic consequences"
                    ]
                }
            }
        };
        
        // Get professional interpretation based on data
        function getProfessionalInterpretation(trendData, seasonalData, anomalyScore, volatility, trendStrength) {
            // Determine trend characteristics
            const trendChange = trendData.length > 1 ? 
                ((trendData[trendData.length - 1] - trendData[0]) / Math.abs(trendData[0])) * 100 : 0;
            
            let trendDirection = "stable";
            let trendSignificance = "Stable";
            let trendTemplate = interpretationTemplates.trend_analysis.stable;
            
            if (Math.abs(trendChange) > 20) {
                trendDirection = trendChange > 0 ? "strong_increasing" : "decreasing";
                trendSignificance = trendChange > 0 ? "Strong Increasing" : "Strong Decreasing";
                trendTemplate = interpretationTemplates.trend_analysis[trendDirection] || interpretationTemplates.trend_analysis.stable;
            } else if (Math.abs(trendChange) > 10) {
                trendDirection = trendChange > 0 ? "moderate_increasing" : "decreasing";
                trendSignificance = trendChange > 0 ? "Moderate Increasing" : "Moderate Decreasing";
                trendTemplate = interpretationTemplates.trend_analysis[trendDirection] || interpretationTemplates.trend_analysis.stable;
            }
            
            // Determine seasonal pattern
            let seasonalPattern = "normal";
            let seasonalTemplate = interpretationTemplates.seasonal_patterns.early_peak;
            
            if (seasonalData.length > 0) {
                const seasonalStrength = Math.max(...seasonalData) - Math.min(...seasonalData);
                if (seasonalStrength > trendStrength * 0.5) {
                    seasonalPattern = "early_peak";
                    seasonalTemplate = interpretationTemplates.seasonal_patterns.early_peak;
                } else if (seasonalStrength > trendStrength * 0.2) {
                    seasonalPattern = "late_peak";
                    seasonalTemplate = interpretationTemplates.seasonal_patterns.late_peak;
                }
            }
            
            // Determine anomaly assessment
            let anomalyTemplate = interpretationTemplates.anomaly_assessment.extreme_high;
            if (Math.abs(anomalyScore) > 2.0) {
                anomalyTemplate = anomalyScore > 0 ? 
                    interpretationTemplates.anomaly_assessment.extreme_high :
                    interpretationTemplates.anomaly_assessment.extreme_low;
            }
            
            return {
                trend: {
                    title: trendTemplate.title,
                    description: trendTemplate.description,
                    magnitude: `${Math.abs(trendChange).toFixed(1)}%`,
                    direction: trendSignificance,
                    implications: trendTemplate.implications
                },
                seasonal: {
                    title: seasonalTemplate.title,
                    description: seasonalTemplate.description,
                    pattern: seasonalPattern,
                    implications: seasonalTemplate.implications
                },
                anomaly: {
                    title: anomalyTemplate.title,
                    description: anomalyTemplate.description,
                    score: anomalyScore,
                    severity: Math.abs(anomalyScore) > 2.0 ? "extreme" : Math.abs(anomalyScore) > 1.0 ? "moderate" : "normal",
                    causes: anomalyTemplate.causes,
                    risks: anomalyTemplate.risks
                },
                data_quality: {
                    volatility: volatility.toFixed(2),
                    stability: volatility > trendStrength * 0.3 ? "High variability, monitor for anomalies" : "Relatively stable, data reliable"
                }
            };
        }
        
        // Generate monitoring recommendations
        function generateMonitoringRecommendations(interpretation) {
            const recommendations = [];
            
            // Based on trend
            if (interpretation.trend.direction.includes("Increasing")) {
                recommendations.push("Monitor flood protection infrastructure capacity");
                recommendations.push("Update flood risk assessments and emergency plans");
                recommendations.push("Consider adaptive management strategies for changing conditions");
            } else if (interpretation.trend.direction.includes("Decreasing")) {
                recommendations.push("Assess water resource availability for summer months");
                recommendations.push("Monitor drought indicators and agricultural impacts");
                recommendations.push("Consider water conservation and efficiency measures");
            }
            
            // Based on anomaly
            if (interpretation.anomaly.severity === "extreme") {
                recommendations.push("Implement enhanced monitoring and early warning systems");
                recommendations.push("Prepare emergency response protocols");
                recommendations.push("Communicate risks to stakeholders and public");
            } else if (interpretation.anomaly.severity === "moderate") {
                recommendations.push("Increase monitoring frequency");
                recommendations.push("Review and update response plans");
                recommendations.push("Prepare for potential extreme events");
            }
            
            // General recommendations
            recommendations.push("Maintain regular data quality assessments");
            recommendations.push("Update models with new observations");
            recommendations.push("Coordinate with regional water management agencies");
            
            return recommendations;
        }
        
        // Display professional interpretation
        function displayProfessionalInterpretation(container, interpretation) {
            const recommendations = generateMonitoringRecommendations(interpretation);
            
            container.innerHTML = `
                <div class="card interpretation-card">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0"><i class="fas fa-chart-line"></i> Professional SWE Analysis - Hydrological Interpretation</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary">${interpretation.trend.title}</h6>
                                <p class="small text-muted">${interpretation.trend.description}</p>
                                <p><strong>Trend Magnitude:</strong> ${interpretation.trend.magnitude} change</p>
                                <p><strong>Direction:</strong> ${interpretation.trend.direction}</p>
                                <ul class="small">
                                    ${interpretation.trend.implications.map(imp => `<li>${imp}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-info">${interpretation.seasonal.title}</h6>
                                <p class="small text-muted">${interpretation.seasonal.description}</p>
                                <p><strong>Pattern:</strong> ${interpretation.seasonal.pattern}</p>
                                <ul class="small">
                                    ${interpretation.seasonal.implications.map(imp => `<li>${imp}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-warning">${interpretation.anomaly.title}</h6>
                                <p class="small text-muted">${interpretation.anomaly.description}</p>
                                <p><strong>Anomaly Score:</strong> ${interpretation.anomaly.score.toFixed(2)} (${interpretation.anomaly.severity})</p>
                                <p><strong>Data Quality:</strong> ${interpretation.data_quality.stability}</p>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-success">Management Recommendations</h6>
                                <ul class="small">
                                    ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Test functions
        function testTrendAnalysis() {
            const trendData = [50, 55, 60, 65, 70];
            const seasonalData = [10, 15, 20, 15, 10];
            const anomalyScore = 1.5;
            const volatility = 8.5;
            const trendStrength = 25;
            
            const interpretation = getProfessionalInterpretation(trendData, seasonalData, anomalyScore, volatility, trendStrength);
            displayProfessionalInterpretation(document.getElementById('trend-result'), interpretation);
        }

        function testSeasonalPatterns() {
            const trendData = [30, 35, 40, 35, 30];
            const seasonalData = [25, 30, 35, 30, 25];
            const anomalyScore = 0.8;
            const volatility = 5.2;
            const trendStrength = 15;
            
            const interpretation = getProfessionalInterpretation(trendData, seasonalData, anomalyScore, volatility, trendStrength);
            displayProfessionalInterpretation(document.getElementById('seasonal-result'), interpretation);
        }

        function testAnomalyDetection() {
            const trendData = [40, 42, 45, 80, 85];
            const seasonalData = [5, 8, 10, 8, 5];
            const anomalyScore = 2.8;
            const volatility = 20.5;
            const trendStrength = 50;
            
            const interpretation = getProfessionalInterpretation(trendData, seasonalData, anomalyScore, volatility, trendStrength);
            displayProfessionalInterpretation(document.getElementById('anomaly-result'), interpretation);
        }

        function testStablePatterns() {
            const trendData = [45, 46, 47, 48, 49];
            const seasonalData = [2, 3, 2, 3, 2];
            const anomalyScore = 0.3;
            const volatility = 2.1;
            const trendStrength = 8;
            
            const interpretation = getProfessionalInterpretation(trendData, seasonalData, anomalyScore, volatility, trendStrength);
            displayProfessionalInterpretation(document.getElementById('stable-result'), interpretation);
        }

        function testDecreasingTrend() {
            const trendData = [60, 58, 55, 52, 48];
            const seasonalData = [8, 10, 12, 10, 8];
            const anomalyScore = -0.5;
            const volatility = 6.8;
            const trendStrength = 22;
            
            const interpretation = getProfessionalInterpretation(trendData, seasonalData, anomalyScore, volatility, trendStrength);
            displayProfessionalInterpretation(document.getElementById('decreasing-result'), interpretation);
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
