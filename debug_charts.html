<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¨ å›¾è¡¨é—®é¢˜è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .debug-section { margin: 20px 0; padding: 20px; border: 2px solid #dc3545; border-radius: 8px; background: white; }
        .chart-alternative { height: 300px; border: 2px solid #007bff; margin: 15px 0; padding: 10px; }
        .interpretation { background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; max-height: 200px; }
        .bar { background: #2ecc71; margin: 2px 0; padding: 5px; border-radius: 3px; }
        .canvas-chart { border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>ğŸš¨ çœ‹é—¨ç‹—+é«˜æ‰‹ å›¾è¡¨é—®é¢˜è°ƒè¯•</h1>
    
    <div class="debug-section">
        <h2>1. åŸå§‹APIæ•°æ®æµ‹è¯•</h2>
        <div id="api-data"></div>
    </div>

    <div class="debug-section">
        <h2>2. ç®€å•HTMLå›¾è¡¨æ›¿ä»£æ–¹æ¡ˆ</h2>
        <div id="simple-chart" class="chart-alternative"></div>
        <div id="simple-interpretation" class="interpretation"></div>
    </div>

    <div class="debug-section">
        <h2>3. Canvaså›¾è¡¨æ›¿ä»£æ–¹æ¡ˆ</h2>
        <canvas id="canvas-chart" class="canvas-chart" width="800" height="300"></canvas>
        <div id="canvas-interpretation" class="interpretation"></div>
    </div>

    <div class="debug-section">
        <h2>4. çº¯CSSå›¾è¡¨æ›¿ä»£æ–¹æ¡ˆ</h2>
        <div id="css-chart" class="chart-alternative"></div>
        <div id="css-interpretation" class="interpretation"></div>
    </div>

    <script>
        async function testClusteringAPI() {
            try {
                const response = await fetch('/api/v1/data-science/clustering');
                const data = await response.json();
                
                document.getElementById('api-data').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                
                if (data.success && data.results) {
                    const results = data.results;
                    
                    // 1. ç®€å•HTMLå›¾è¡¨
                    createSimpleChart(results);
                    
                    // 2. Canvaså›¾è¡¨
                    createCanvasChart(results);
                    
                    // 3. çº¯CSSå›¾è¡¨
                    createCSSChart(results);
                    
                    // æ˜¾ç¤ºè§£è¯»
                    displayInterpretation(results);
                }
                
            } catch (error) {
                document.getElementById('api-data').innerHTML = `<div class="error">âŒ APIé”™è¯¯: ${error.message}</div>`;
            }
        }

        function createSimpleChart(results) {
            const labels = results.kmeans.labels || [];
            const counts = {};
            labels.forEach(l => { const k = String(l); counts[k] = (counts[k]||0)+1; });
            
            let html = '<h4>èšç±»å¤§å°åˆ†å¸ƒ (HTMLè¡¨æ ¼)</h4><table border="1" style="width:100%">';
            html += '<tr><th>èšç±»ID</th><th>æ•°æ®ç‚¹æ•°é‡</th><th>å¯è§†åŒ–</th></tr>';
            
            Object.keys(counts).sort().forEach(key => {
                const count = counts[key];
                const barWidth = Math.max(1, (count / Math.max(...Object.values(counts))) * 200);
                html += `<tr>
                    <td>${key}</td>
                    <td>${count}</td>
                    <td><div class="bar" style="width:${barWidth}px">${count}</div></td>
                </tr>`;
            });
            
            html += '</table>';
            document.getElementById('simple-chart').innerHTML = html;
        }

        function createCanvasChart(results) {
            const canvas = document.getElementById('canvas-chart');
            const ctx = canvas.getContext('2d');
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const labels = results.kmeans.labels || [];
            const counts = {};
            labels.forEach(l => { const k = String(l); counts[k] = (counts[k]||0)+1; });
            
            const keys = Object.keys(counts).sort();
            const values = keys.map(k => counts[k]);
            const maxValue = Math.max(...values);
            
            // ç»˜åˆ¶æ¡å½¢å›¾
            const barWidth = 60;
            const barSpacing = 20;
            const chartHeight = 200;
            const startX = 50;
            const startY = 250;
            
            ctx.fillStyle = '#2ecc71';
            ctx.font = '14px Arial';
            
            keys.forEach((key, index) => {
                const value = counts[key];
                const barHeight = (value / maxValue) * chartHeight;
                const x = startX + index * (barWidth + barSpacing);
                const y = startY - barHeight;
                
                // ç»˜åˆ¶æ¡å½¢
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // ç»˜åˆ¶æ ‡ç­¾
                ctx.fillStyle = '#000';
                ctx.fillText(key, x + barWidth/2 - 5, startY + 20);
                ctx.fillText(value.toString(), x + barWidth/2 - 5, y - 5);
                ctx.fillStyle = '#2ecc71';
            });
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#000';
            ctx.font = '16px Arial';
            ctx.fillText('K-meansèšç±»å¤§å°åˆ†å¸ƒ (Canvas)', 50, 30);
        }

        function createCSSChart(results) {
            const labels = results.kmeans.labels || [];
            const counts = {};
            labels.forEach(l => { const k = String(l); counts[k] = (counts[k]||0)+1; });
            
            const maxValue = Math.max(...Object.values(counts));
            let html = '<h4>èšç±»å¤§å°åˆ†å¸ƒ (CSSåŠ¨ç”»)</h4>';
            html += '<div style="display: flex; align-items: end; height: 200px; gap: 10px;">';
            
            Object.keys(counts).sort().forEach(key => {
                const count = counts[key];
                const height = (count / maxValue) * 180;
                html += `<div style="
                    background: linear-gradient(to top, #2ecc71, #27ae60);
                    width: 50px;
                    height: ${height}px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                    border-radius: 4px 4px 0 0;
                    transition: all 0.3s ease;
                    cursor: pointer;
                    position: relative;
                " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                    ${count}
                    <div style="position: absolute; bottom: -25px; color: #333; font-size: 12px;">Cluster ${key}</div>
                </div>`;
            });
            
            html += '</div>';
            document.getElementById('css-chart').innerHTML = html;
        }

        function displayInterpretation(results) {
            let interpretationHTML = '';
            
            if (results.interpretation) {
                const interp = results.interpretation;
                interpretationHTML = '<h4>ğŸŒ èšç±»åˆ†æè§£è¯»</h4>';
                
                if (interp.summary) {
                    interpretationHTML += `<p><strong>æ‘˜è¦:</strong> ${interp.summary}</p>`;
                }
                
                if (interp.key_insights && interp.key_insights.length > 0) {
                    interpretationHTML += '<p><strong>å…³é”®æ´å¯Ÿ:</strong></p><ul>';
                    interp.key_insights.forEach(insight => {
                        interpretationHTML += `<li>${insight}</li>`;
                    });
                    interpretationHTML += '</ul>';
                }
                
                if (interp.business_implications) {
                    interpretationHTML += `<p><strong>ä¸šåŠ¡å½±å“:</strong> ${interp.business_implications}</p>`;
                }
                
                if (interp.recommendations && interp.recommendations.length > 0) {
                    interpretationHTML += '<p><strong>å»ºè®®:</strong></p><ul>';
                    interp.recommendations.forEach(rec => {
                        interpretationHTML += `<li>${rec}</li>`;
                    });
                    interpretationHTML += '</ul>';
                }
            } else {
                interpretationHTML = '<div class="error">âŒ è§£è¯»æ•°æ®ç¼ºå¤±</div>';
            }
            
            // æ˜¾ç¤ºåœ¨æ‰€æœ‰è§£è¯»å®¹å™¨ä¸­
            document.getElementById('simple-interpretation').innerHTML = interpretationHTML;
            document.getElementById('canvas-interpretation').innerHTML = interpretationHTML;
            document.getElementById('css-interpretation').innerHTML = interpretationHTML;
        }

        // é¡µé¢åŠ è½½åç«‹å³æµ‹è¯•
        document.addEventListener('DOMContentLoaded', testClusteringAPI);
    </script>
</body>
</html>



