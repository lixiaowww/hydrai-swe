<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœŸé€»è¾‘æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 3px; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input, select { padding: 5px; margin: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ—¥æœŸé€»è¾‘æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•1: æ¨¡å¼åˆ‡æ¢</h3>
        <label>é¢„æµ‹æ¨¡å¼:</label>
        <select id="mode" onchange="updateDateFields()">
            <option value="nowcast">å®æ—¶é¢„æµ‹ (Nowcast)</option>
            <option value="scenario">æƒ…æ™¯æ¨¡æ‹Ÿ (Scenario)</option>
        </select>
        
        <div class="result">
            <strong>å½“å‰æ¨¡å¼:</strong> <span id="currentMode">nowcast</span>
        </div>
    </div>
    
    <div class="test-section">
        <h3>æµ‹è¯•2: æƒ…æ™¯å¹´ä»½è®¾ç½®</h3>
        <label>æƒ…æ™¯å¹´ä»½:</label>
        <input type="number" id="scenarioYear" value="2023" min="1979" max="2024" onchange="onScenarioYearChange()">
        
        <label>æ•°æ®èŒƒå›´é€‰æ‹©:</label>
        <select id="dataRangeSelector" onchange="updateScenarioYearRange()">
            <option value="auto">Auto-select (Recommended)</option>
            <option value="historical">Historical Depth Priority (1979-1998)</option>
            <option value="recent">Recent Accuracy Priority (2020-2024)</option>
            <option value="mixed">Mixed Use (1979-2024)</option>
        </select>
        
        <div class="result">
            <strong>å½“å‰æƒ…æ™¯å¹´ä»½:</strong> <span id="currentYear">2023</span>
            <br>
            <strong>å¹´ä»½èŒƒå›´:</strong> <span id="yearRange">1979-2024</span>
            <br>
            <strong>æç¤ºä¿¡æ¯:</strong> <span id="yearHint">è‡ªåŠ¨é€‰æ‹©ï¼šä¼˜å…ˆä½¿ç”¨2020-2024å¹´æ•°æ®ï¼Œå¿…è¦æ—¶è¡¥å……å†å²æ•°æ®</span>
        </div>
    </div>
    
    <div class="test-section">
        <h3>æµ‹è¯•3: æ—¥æœŸå­—æ®µ</h3>
        <label>å¼€å§‹æ—¥æœŸ:</label>
        <input type="date" id="start">
        <small id="startDateHint">YYYY-MM-DD format for future predictions</small>
        
        <br><br>
        
        <label>ç»“æŸæ—¥æœŸ:</label>
        <input type="date" id="end">
        <small id="endDateHint">YYYY-MM-DD format for future predictions</small>
        
        <div class="result">
            <strong>å¼€å§‹æ—¥æœŸå€¼:</strong> <span id="startValue">æœªè®¾ç½®</span>
            <br>
            <strong>ç»“æŸæ—¥æœŸå€¼:</strong> <span id="endValue">æœªè®¾ç½®</span>
            <br>
            <strong>æ—¥æœŸç±»å‹:</strong> <span id="dateType">date</span>
        </div>
    </div>
    
    <div class="test-section">
        <h3>æµ‹è¯•4: é€»è¾‘éªŒè¯</h3>
        <button onclick="validateDateLogic()">éªŒè¯æ—¥æœŸé€»è¾‘</button>
        <button onclick="testScenarioMode()">æµ‹è¯•æƒ…æ™¯æ¨¡å¼</button>
        <button onclick="testNowcastMode()">æµ‹è¯•å®æ—¶é¢„æµ‹æ¨¡å¼</button>
        
        <div id="validationResult" class="result">
            ç‚¹å‡»æŒ‰é’®å¼€å§‹éªŒè¯...
        </div>
    </div>
    
    <script>
        // æ¨¡æ‹ŸåŸå§‹é¡µé¢çš„å‡½æ•°
        function updateDateFields() {
            const mode = document.getElementById('mode').value;
            const startDate = document.getElementById('start');
            const endDate = document.getElementById('end');
            const startHint = document.getElementById('startDateHint');
            const endHint = document.getElementById('endDateHint');
            const currentMode = document.getElementById('currentMode');
            
            currentMode.textContent = mode;
            
            if (mode === 'scenario') {
                startHint.textContent = 'MM-DD format (year determined by scenario year)';
                endHint.textContent = 'MM-DD format (year determined by scenario year)';
                
                // è®¾ç½®é»˜è®¤æ˜¥å­£èé›ªæ—¥æœŸ
                const scenarioYear = document.getElementById('scenarioYear').value;
                startDate.value = `${scenarioYear}-03-15`;
                endDate.value = `${scenarioYear}-05-15`;
                
                startDate.type = 'date';
                endDate.type = 'date';
            } else {
                startHint.textContent = 'YYYY-MM-DD format for future predictions';
                endHint.textContent = 'YYYY-MM-DD format for future predictions';
                
                // è®¾ç½®é»˜è®¤ä¸‹å‘¨æ—¥æœŸ
                const today = new Date();
                const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                startDate.value = today.toISOString().split('T')[0];
                endDate.value = nextWeek.toISOString().split('T')[0];
                
                startDate.type = 'date';
                endDate.type = 'date';
            }
            
            updateDisplayValues();
        }
        
        function updateScenarioYearRange() {
            const selector = document.getElementById('dataRangeSelector');
            const yearInput = document.getElementById('scenarioYear');
            const hint = document.getElementById('yearHint');
            const yearRange = document.getElementById('yearRange');
            
            switch (selector.value) {
                case 'historical':
                    yearInput.min = '1979';
                    yearInput.max = '1998';
                    yearInput.value = '1990';
                    hint.textContent = 'ä½¿ç”¨1979-1998å¹´æ·±åº¦å†å²æ•°æ®ï¼Œé€‚åˆé•¿æœŸæ¨¡å¼åˆ†æ';
                    yearRange.textContent = '1979-1998';
                    break;
                case 'recent':
                    yearInput.min = '2020';
                    yearInput.max = '2024';
                    yearInput.value = '2023';
                    hint.textContent = 'ä½¿ç”¨2020-2024å¹´è¿‘æœŸæ•°æ®ï¼Œç²¾åº¦æ›´é«˜ä½†å†å²æ·±åº¦æœ‰é™';
                    yearRange.textContent = '2020-2024';
                    break;
                case 'mixed':
                    yearInput.min = '1979';
                    yearInput.max = '2024';
                    yearInput.value = '2020';
                    hint.textContent = 'æ··åˆä½¿ç”¨1979-2024å¹´æ•°æ®ï¼Œå¹³è¡¡å†å²æ·±åº¦å’Œè¿‘æœŸç²¾åº¦';
                    yearRange.textContent = '1979-2024';
                    break;
                default: // auto
                    yearInput.min = '1979';
                    yearInput.max = '2024';
                    yearInput.value = '2024';
                    hint.textContent = 'è‡ªåŠ¨é€‰æ‹©ï¼šä¼˜å…ˆä½¿ç”¨2020-2024å¹´æ•°æ®ï¼Œå¿…è¦æ—¶è¡¥å……å†å²æ•°æ®';
                    yearRange.textContent = '1979-2024';
            }
            
            updateDisplayValues();
            updateDateFields();
        }
        
        function onScenarioYearChange() {
            const year = document.getElementById('scenarioYear').value;
            document.getElementById('currentYear').textContent = year;
            
            // å¦‚æœå½“å‰æ˜¯æƒ…æ™¯æ¨¡å¼ï¼Œæ›´æ–°æ—¥æœŸå­—æ®µ
            if (document.getElementById('mode').value === 'scenario') {
                updateDateFields();
            }
        }
        
        function updateDisplayValues() {
            const startDate = document.getElementById('start');
            const endDate = document.getElementById('end');
            
            document.getElementById('startValue').textContent = startDate.value || 'æœªè®¾ç½®';
            document.getElementById('endValue').textContent = endDate.value || 'æœªè®¾ç½®';
            document.getElementById('dateType').textContent = startDate.type;
        }
        
        function validateDateLogic() {
            const mode = document.getElementById('mode').value;
            const scenarioYear = document.getElementById('scenarioYear').value;
            const startDate = document.getElementById('start').value;
            const endDate = document.getElementById('end').value;
            
            let isValid = true;
            let messages = [];
            
            if (mode === 'scenario') {
                // éªŒè¯æƒ…æ™¯æ¨¡å¼ä¸‹çš„æ—¥æœŸé€»è¾‘
                if (startDate && startDate.startsWith(scenarioYear)) {
                    messages.push(`âœ… å¼€å§‹æ—¥æœŸå¹´ä»½åŒ¹é…: ${startDate}`);
                } else {
                    messages.push(`âŒ å¼€å§‹æ—¥æœŸå¹´ä»½ä¸åŒ¹é…: æœŸæœ›${scenarioYear}ï¼Œå®é™…${startDate}`);
                    isValid = false;
                }
                
                if (endDate && endDate.startsWith(scenarioYear)) {
                    messages.push(`âœ… ç»“æŸæ—¥æœŸå¹´ä»½åŒ¹é…: ${endDate}`);
                } else {
                    messages.push(`âŒ ç»“æŸæ—¥æœŸå¹´ä»½ä¸åŒ¹é…: æœŸæœ›${scenarioYear}ï¼Œå®é™…${endDate}`);
                    isValid = false;
                }
                
                // éªŒè¯æ—¥æœŸé¡ºåº
                if (startDate && endDate && startDate < endDate) {
                    messages.push(`âœ… æ—¥æœŸé¡ºåºæ­£ç¡®: ${startDate} < ${endDate}`);
                } else {
                    messages.push(`âŒ æ—¥æœŸé¡ºåºé”™è¯¯: ${startDate} >= ${endDate}`);
                    isValid = false;
                }
            } else {
                // éªŒè¯å®æ—¶é¢„æµ‹æ¨¡å¼ä¸‹çš„æ—¥æœŸé€»è¾‘
                const today = new Date();
                const startDateObj = new Date(startDate);
                const endDateObj = new Date(endDate);
                
                if (startDateObj >= today) {
                    messages.push(`âœ… å¼€å§‹æ—¥æœŸæ˜¯æœªæ¥æ—¥æœŸ: ${startDate}`);
                } else {
                    messages.push(`âŒ å¼€å§‹æ—¥æœŸä¸æ˜¯æœªæ¥æ—¥æœŸ: ${startDate}`);
                    isValid = false;
                }
                
                if (endDateObj > startDateObj) {
                    messages.push(`âœ… ç»“æŸæ—¥æœŸæ™šäºå¼€å§‹æ—¥æœŸ: ${endDate} > ${startDate}`);
                } else {
                    messages.push(`âŒ ç»“æŸæ—¥æœŸä¸æ™šäºå¼€å§‹æ—¥æœŸ: ${endDate} <= ${startDate}`);
                    isValid = false;
                }
            }
            
            const resultDiv = document.getElementById('validationResult');
            resultDiv.innerHTML = messages.join('<br>');
            resultDiv.className = isValid ? 'result success' : 'result error';
        }
        
        function testScenarioMode() {
            document.getElementById('mode').value = 'scenario';
            updateDateFields();
            validateDateLogic();
        }
        
        function testNowcastMode() {
            document.getElementById('mode').value = 'nowcast';
            updateDateFields();
            validateDateLogic();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateDateFields();
            updateScenarioYearRange();
            updateDisplayValues();
        });
    </script>
</body>
</html>
