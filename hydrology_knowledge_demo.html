<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HydrAI-SWE æ°´æ–‡çŸ¥è¯†åº“ç³»ç»Ÿæ¼”ç¤º</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 0;
            font-size: 1.1em;
            opacity: 0.9;
        }
        .content {
            padding: 30px;
        }
        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 5px solid #007bff;
        }
        .demo-section h2 {
            color: #2c3e50;
            margin-top: 0;
            font-size: 1.8em;
        }
        .control-panel {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }
        .control-group label {
            font-weight: bold;
            min-width: 120px;
        }
        .control-group select, .control-group input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        .btn:active {
            transform: translateY(0);
        }
        .results {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #dee2e6;
        }
        .interpretation-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 15px 0;
            border-radius: 6px;
        }
        .interpretation-card h3 {
            margin: 0 0 10px 0;
            color: #155724;
            font-size: 1.3em;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        .metric-label {
            color: #6c757d;
            font-weight: 500;
        }
        .recommendations {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        .recommendations h4 {
            margin: 0 0 10px 0;
            color: #856404;
        }
        .recommendations ul {
            margin: 10px 0 0 20px;
            color: #856404;
        }
        .loading {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #f5c6cb;
            margin: 15px 0;
        }
        .api-info {
            background: #d1ecf1;
            border: 1px solid #b8daff;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 14px;
        }
        .api-info h4 {
            margin: 0 0 10px 0;
            color: #0c5460;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒŠ HydrAI-SWE æ°´æ–‡çŸ¥è¯†åº“ç³»ç»Ÿ</h1>
            <p>ä¸“ä¸šæ°´æ–‡å­¦è§£è¯» Â· åŒºåŸŸèƒŒæ™¯åˆ†æ Â· æ°”å€™å˜åŒ–å½±å“è¯„ä¼°</p>
        </div>

        <div class="content">
            <!-- ç³»ç»Ÿæ¶æ„è¯´æ˜ -->
            <div class="demo-section">
                <h2>ğŸ—ï¸ ç³»ç»Ÿæ¶æ„</h2>
                <p>HydrAI-SWEæ°´æ–‡çŸ¥è¯†åº“ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå°†ä¸“ä¸šæ°´æ–‡å­¦çŸ¥è¯†ä¸æœºå™¨å­¦ä¹ åˆ†æç›¸ç»“åˆï¼š</p>
                
                <div class="api-info">
                    <h4>æ ¸å¿ƒç»„ä»¶</h4>
                    <ul>
                        <li><strong>æ°´æ–‡çŸ¥è¯†åº“</strong> - <code>hydrology_knowledge_base.py</code> - å­˜å‚¨ä¸“ä¸šæ°´æ–‡å­¦çŸ¥è¯†</li>
                        <li><strong>å¢å¼ºè§£é‡ŠæœåŠ¡</strong> - <code>enhanced_interpretation.py</code> - æä¾›ä¸“ä¸šè§£è¯»API</li>
                        <li><strong>å‰ç«¯è§£é‡Šç³»ç»Ÿ</strong> - JavaScriptå‡½æ•°ç”Ÿæˆç”¨æˆ·å¯ç†è§£çš„æ´å¯Ÿ</li>
                        <li><strong>åŒºåŸŸèƒŒæ™¯æ¨¡å—</strong> - æ›¼å°¼æ‰˜å·´çœå’Œçº¢æ²³æµåŸŸç‰¹å®šçŸ¥è¯†</li>
                    </ul>
                </div>

                <div class="code-block">
                    # åç«¯çŸ¥è¯†åº“è°ƒç”¨ç¤ºä¾‹
from src.knowledge.hydrology_knowledge_base import HydrologyKnowledgeBase

# åˆ›å»ºçŸ¥è¯†åº“å®ä¾‹
kb = HydrologyKnowledgeBase()

# è·å–ä¸“ä¸šè§£è¯»
interpretation = kb.get_swe_interpretation(
    trend_direction="increasing",
    trend_magnitude=25.5,
    seasonal_pattern="early_peak", 
    anomaly_score=2.3,
    forecast_confidence=0.85
)
                </div>
            </div>

            <!-- å®æ—¶è§£è¯»æ¼”ç¤º -->
            <div class="demo-section">
                <h2>ğŸ“Š å®æ—¶ä¸“ä¸šè§£è¯»æ¼”ç¤º</h2>
                
                <div class="control-panel">
                    <h3>åˆ†æå‚æ•°è®¾ç½®</h3>
                    
                    <div class="control-group">
                        <label>è¶‹åŠ¿æ–¹å‘:</label>
                        <select id="trendDirection">
                            <option value="increasing">é€’å¢</option>
                            <option value="decreasing">é€’å‡</option>
                            <option value="stable">ç¨³å®š</option>
                        </select>
                        
                        <label>è¶‹åŠ¿å¹…åº¦ (%):</label>
                        <input type="number" id="trendMagnitude" value="25.5" min="-100" max="100" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label>å­£èŠ‚æ€§æ¨¡å¼:</label>
                        <select id="seasonalPattern">
                            <option value="early_peak">æ—©æœŸå³°å€¼</option>
                            <option value="late_peak">æ™šæœŸå³°å€¼</option>
                            <option value="double_peak">åŒå³°æ¨¡å¼</option>
                            <option value="normal">æ­£å¸¸æ¨¡å¼</option>
                        </select>
                        
                        <label>å¼‚å¸¸åˆ†æ•°:</label>
                        <input type="number" id="anomalyScore" value="2.3" min="-5" max="5" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label>é¢„æµ‹ç½®ä¿¡åº¦:</label>
                        <input type="number" id="forecastConfidence" value="0.85" min="0" max="1" step="0.01">
                        
                        <button class="btn" onclick="generateInterpretation()">ğŸ” ç”Ÿæˆä¸“ä¸šè§£è¯»</button>
                    </div>
                </div>

                <div id="interpretationResults" class="results">
                    <div class="loading">ç‚¹å‡»"ç”Ÿæˆä¸“ä¸šè§£è¯»"æŒ‰é’®å¼€å§‹åˆ†æ...</div>
                </div>
            </div>

            <!-- æ°´æ–‡çŸ¥è¯†å±•ç¤º -->
            <div class="demo-section">
                <h2>ğŸ“š æ°´æ–‡çŸ¥è¯†åº“å†…å®¹</h2>
                
                <div class="control-panel">
                    <div class="control-group">
                        <label>çŸ¥è¯†ç±»åˆ«:</label>
                        <select id="knowledgeCategory">
                            <option value="swe_fundamentals">SWEåŸºç¡€çŸ¥è¯†</option>
                            <option value="snowmelt_processes">èé›ªè¿‡ç¨‹</option>
                            <option value="climate_change_impacts">æ°”å€™å˜åŒ–å½±å“</option>
                            <option value="regional_characteristics">åŒºåŸŸç‰¹å¾</option>
                            <option value="forecasting_methods">é¢„æµ‹æ–¹æ³•</option>
                        </select>
                        
                        <button class="btn" onclick="displayKnowledge()">ğŸ“– æ˜¾ç¤ºçŸ¥è¯†</button>
                    </div>
                </div>

                <div id="knowledgeDisplay" class="results">
                    <div class="loading">é€‰æ‹©çŸ¥è¯†ç±»åˆ«å¹¶ç‚¹å‡»æ˜¾ç¤º...</div>
                </div>
            </div>

            <!-- APIæµ‹è¯• -->
            <div class="demo-section">
                <h2>ğŸŒ APIæ¥å£æµ‹è¯•</h2>
                
                <div class="control-panel">
                    <div class="control-group">
                        <label>æµ‹è¯•ç«¯ç‚¹:</label>
                        <select id="apiEndpoint">
                            <option value="glossary">æŠ€æœ¯è¯æ±‡è¡¨</option>
                            <option value="climate-context">æ°”å€™å˜åŒ–ä¿¡æ¯</option>
                            <option value="regional-info">åŒºåŸŸä¿¡æ¯</option>
                        </select>
                        
                        <button class="btn" onclick="testAPI()">ğŸš€ æµ‹è¯•API</button>
                    </div>
                </div>

                <div id="apiResults" class="results">
                    <div class="loading">é€‰æ‹©APIç«¯ç‚¹å¹¶ç‚¹å‡»æµ‹è¯•...</div>
                </div>
            </div>

            <!-- å‰ç«¯é›†æˆç¤ºä¾‹ -->
            <div class="demo-section">
                <h2>ğŸ’» å‰ç«¯é›†æˆå®ç°</h2>
                
                <p>æ— ç›‘ç£å­¦ä¹ æ¨¡å—å¦‚ä½•ä½¿ç”¨æ°´æ–‡çŸ¥è¯†åº“ç”Ÿæˆä¸“ä¸šè§£è¯»ï¼š</p>
                
                <div class="code-block">
// å‰ç«¯JavaScripté›†æˆç¤ºä¾‹
function updateUnsupervisedChart(data) {
    // 1. å¤„ç†æ— ç›‘ç£å­¦ä¹ ç»“æœæ•°æ®
    const insights = data.results.insights;
    
    // 2. æå–å…³é”®æŒ‡æ ‡
    const anomalyScore = calculateAnomalyScore(insights.anomalies);
    const clusterQuality = insights.clustering?.silhouette_score || 0;
    const trendStrength = calculateTrendStrength(insights.pca_data);
    
    // 3. è°ƒç”¨ä¸“ä¸šè§£è¯»ç”Ÿæˆå™¨
    const interpretation = generateProfessionalInterpretation({
        trend_direction: trendStrength > 0 ? "increasing" : "decreasing",
        trend_magnitude: Math.abs(trendStrength),
        anomaly_score: anomalyScore,
        cluster_quality: clusterQuality
    });
    
    // 4. æ˜¾ç¤ºä¸“ä¸šè§£è¯»
    displayProfessionalInterpretation(container, interpretation);
}

function generateProfessionalInterpretation(params) {
    // ä½¿ç”¨æ°´æ–‡çŸ¥è¯†åº“æ¨¡æ¿ç”Ÿæˆè§£è¯»
    return {
        executive_summary: "åŸºäºæ— ç›‘ç£å­¦ä¹ åˆ†æå‘ç°...",
        hydrological_significance: "ä»æ°´æ–‡å­¦è§’åº¦åˆ†æ...", 
        management_recommendations: [
            "å»ºè®®åŠ å¼ºç›‘æµ‹é¢‘ç‡",
            "ä¼˜åŒ–é¢„æµ‹æ¨¡å‹å‚æ•°"
        ]
    };
}
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ°´æ–‡çŸ¥è¯†åº“
        const hydrologyKnowledge = {
            swe_fundamentals: {
                title: "é›ªæ°´å½“é‡(SWE)åŸºç¡€çŸ¥è¯†",
                content: {
                    definition: "é›ªæ°´å½“é‡æ˜¯ç§¯é›ªèåŒ–åæ‰€äº§ç”Ÿçš„æ°´çš„æ·±åº¦ï¼Œé€šå¸¸ä»¥æ¯«ç±³æˆ–è‹±å¯¸è¡¨ç¤ºã€‚",
                    measurement_methods: [
                        "ç§¯é›ªå‘å¯†åº¦æµ‹é‡ï¼ˆé‡‘æ ‡å‡†ï¼‰",
                        "é›ªæ•å‹åŠ›ä¼ æ„Ÿå™¨",
                        "ä¼½é©¬å°„çº¿è¡°å‡ï¼ˆCS725ä¼ æ„Ÿå™¨ï¼‰", 
                        "æ‰‹å·¥é›ªè°ƒæŸ¥å–èŠ¯"
                    ],
                    physical_properties: {
                        density_range: "50-500 kg/mÂ³",
                        typical_ratio: "0.1-0.4 (SWE/snow_depth)"
                    }
                }
            },
            snowmelt_processes: {
                title: "èé›ªè¿‡ç¨‹",
                content: {
                    energy_balance: [
                        "å‡€è¾å°„ï¼ˆå¤ªé˜³è¾å°„+é•¿æ³¢è¾å°„ï¼‰",
                        "æ„Ÿçƒ­é€šé‡",
                        "æ½œçƒ­é€šé‡",
                        "åœ°é¢çƒ­é€šé‡",
                        "é›¨é›ªæ··åˆèƒ½é‡"
                    ],
                    melt_rates: {
                        winter: "0-5 mm/day",
                        spring: "5-25 mm/day", 
                        peak_melt: "20-50 mm/day"
                    }
                }
            },
            climate_change_impacts: {
                title: "æ°”å€™å˜åŒ–å½±å“",
                content: {
                    temperature_effects: [
                        "èé›ªèµ·å§‹æ—¶é—´æå‰",
                        "é›¨é›ªæ··åˆäº‹ä»¶å¢åŠ ",
                        "ç§¯é›ªå­£èŠ‚ç¼©çŸ­",
                        "å†¬å­£æ°”æ¸©å‡é«˜"
                    ],
                    precipitation_changes: [
                        "å†¬å­£é™æ°´å¢åŠ ",
                        "å¼ºé™é›¨äº‹ä»¶å¢å¤š",
                        "å˜åŒ–æ€§å¢å¼º",
                        "æç«¯äº‹ä»¶å¯èƒ½å¢åŠ "
                    ]
                }
            },
            regional_characteristics: {
                title: "æ›¼å°¼æ‰˜å·´çœæ°´æ–‡ç‰¹å¾",
                content: {
                    climate: {
                        winter: "å¯’å†·æ¼«é•¿çš„å†¬å­£ï¼ŒæŒç»­ç§¯é›ªè¦†ç›–",
                        spring: "å¿«é€Ÿèé›ªï¼Œæ½œåœ¨æ´ªæ°´é£é™©",
                        summer: "æ¸©æš–å¤å­£ï¼Œå¯¹æµæ€§é™æ°´",
                        fall: "é€æ¸é™æ¸©ï¼Œæ—©æœŸé™é›ª"
                    },
                    red_river_basin: {
                        topography: "ä½èµ·ä¼æµåŸŸï¼Œæœ€å°æµ·æ‹”å·®å¼‚",
                        soils: "é‡ç²˜åœŸï¼Œä½æ¸—é€èƒ½åŠ›",
                        drainage: "ç”±äºåœ°å½¢å¹³å¦ï¼Œè‡ªç„¶æ’æ°´å·®",
                        flood_risk: "ç”±äºå¿«é€Ÿèé›ªå’Œæ’æ°´å·®ï¼Œæ´ªæ°´é£é™©é«˜"
                    }
                }
            },
            forecasting_methods: {
                title: "æ°´æ–‡é¢„æµ‹æ–¹æ³•",
                content: {
                    statistical: [
                        "å¤šå…ƒçº¿æ€§å›å½’",
                        "æ—¶é—´åºåˆ—åˆ†æ(ARIMA)",
                        "ç›¸å…³æ€§åˆ†æ",
                        "è¶‹åŠ¿åˆ†æ"
                    ],
                    physical: [
                        "èƒ½é‡å¹³è¡¡æ¨¡å‹",
                        "åˆ†å¸ƒå¼æ°´æ–‡æ¨¡å‹",
                        "æ¦‚å¿µæ¨¡å‹(HBV, VIC)",
                        "åŸºäºè¿‡ç¨‹çš„æ¨¡å‹"
                    ],
                    machine_learning: [
                        "ç¥ç»ç½‘ç»œ(LSTM, GRU)",
                        "éšæœºæ£®æ—",
                        "æ”¯æŒå‘é‡æœº",
                        "é›†æˆæ–¹æ³•"
                    ]
                }
            }
        };

        // è§£è¯»æ¨¡æ¿
        const interpretationTemplates = {
            trend_analysis: {
                strong_increasing: {
                    title: "å¼ºå¢é•¿è¶‹åŠ¿",
                    description: "SWEæ˜¾ç¤ºå¼ºçƒˆçš„å¢é•¿è¶‹åŠ¿ï¼Œè¡¨æ˜æ˜¾è‘—çš„ç§¯ç´¯æ¨¡å¼ï¼Œå¯èƒ½åæ˜ æ°”å€™å˜åŒ–å½±å“æˆ–è‡ªç„¶å˜å¼‚æ€§å‘¨æœŸã€‚",
                    implications: [
                        "æ˜¥å­£æ´ªæ°´é£é™©å¢åŠ çš„å¯èƒ½æ€§",
                        "å¤å­£æœˆä»½æ°´å­˜å‚¨å¢å¼º",
                        "å¯èƒ½çš„æ°”å€™å˜åŒ–ä¿¡å·",
                        "éœ€è¦æ›´æ–°æ´ªæ°´é˜²æŠ¤æ ‡å‡†"
                    ]
                },
                moderate_increasing: {
                    title: "ä¸­ç­‰å¢é•¿è¶‹åŠ¿",
                    description: "ä¸­ç­‰å¢é•¿è¶‹åŠ¿è¡¨æ˜å†¬å­£é™æ°´æ¨¡å¼æˆ–é›ªä¿ç•™çš„æ¸è¿›å˜åŒ–ã€‚",
                    implications: [
                        "æ´ªæ°´é£é™©è½»å¾®å¢åŠ ",
                        "æ°´èµ„æºå¯ç”¨æ€§æ”¹å–„",
                        "å»ºè®®ç›‘æ§è¶‹åŠ¿æŒç»­æ€§"
                    ]
                },
                stable: {
                    title: "ç¨³å®šè¶‹åŠ¿",
                    description: "ç¨³å®šçš„SWEæ¨¡å¼è¡¨æ˜ä¸€è‡´çš„å†¬å­£æ°”å€™æ¡ä»¶å’Œå¯é¢„æµ‹çš„æ°´æ–‡è¡Œä¸ºã€‚",
                    implications: [
                        "å¯ä»¥è¿›è¡Œå¯é çš„æ´ªæ°´é¢„æµ‹",
                        "ä¸€è‡´çš„æ°´èµ„æºè§„åˆ’",
                        "ç°æœ‰åŸºç¡€è®¾æ–½å……è¶³"
                    ]
                },
                decreasing: {
                    title: "ä¸‹é™è¶‹åŠ¿",
                    description: "SWEä¸‹é™è¶‹åŠ¿å¯èƒ½è¡¨æ˜æ°”å€™å˜åŒ–å½±å“ã€å†¬å­£é™æ°´å‡å°‘æˆ–èé›ªèµ·å§‹æå‰ã€‚",
                    implications: [
                        "æ´ªæ°´é£é™©é™ä½ä½†æ½œåœ¨å¹²æ—±æ‹…å¿§",
                        "æ˜¥å­£å¾„æµæ—¶é—´æå‰",
                        "å¯èƒ½çš„æ°´èµ„æºæŒ‘æˆ˜",
                        "éœ€è¦é€‚åº”ç­–ç•¥"
                    ]
                }
            },
            seasonal_patterns: {
                early_peak: {
                    title: "æ—©æœŸå³°å€¼æ¨¡å¼",
                    description: "æ—©æœŸå³°å€¼SWEè¡¨æ˜å¿«é€Ÿå†¬å­£ç§¯ç´¯ï¼Œéšåæ—©æœŸèé›ªèµ·å§‹ã€‚",
                    implications: [
                        "æ˜¥å­£æ´ªæ°´é£é™©æå‰",
                        "ç”Ÿé•¿å­£èŠ‚å»¶é•¿çš„å¯èƒ½æ€§",
                        "å¤å­£æ°´å¯ç”¨æ€§å‡å°‘",
                        "ç”Ÿæ€ç³»ç»Ÿæ—¶é—´æ”¹å˜"
                    ]
                },
                late_peak: {
                    title: "æ™šæœŸå³°å€¼æ¨¡å¼", 
                    description: "æ™šæœŸå³°å€¼SWEè¡¨æ˜å»¶é•¿çš„å†¬å­£æ¡ä»¶ï¼Œèé›ªèµ·å§‹å»¶è¿Ÿã€‚",
                    implications: [
                        "æ˜¥å­£æ´ªæ°´é£é™©å»¶è¿Ÿ",
                        "ç”Ÿé•¿å­£èŠ‚å‹ç¼©",
                        "å†¬å­£å¨±ä¹æ´»åŠ¨æœºä¼šå»¶é•¿",
                        "å¿«é€Ÿèé›ªäº‹ä»¶çš„å¯èƒ½æ€§"
                    ]
                },
                double_peak: {
                    title: "åŒå³°æ¨¡å¼",
                    description: "åŒå³°æ¨¡å¼è¡¨æ˜å¤æ‚çš„å†¬å­£å¤©æ°”ï¼Œå¤šæ¬¡ç§¯ç´¯å’Œèé›ªå‘¨æœŸã€‚",
                    implications: [
                        "å¤šä¸ªæ´ªæ°´é£é™©æœŸ",
                        "å¤æ‚çš„é¢„æµ‹è¦æ±‚",
                        "å˜åŒ–çš„æ°´å¯ç”¨æ€§",
                        "éœ€è¦é€‚åº”æ€§ç®¡ç†"
                    ]
                },
                normal: {
                    title: "æ­£å¸¸å­£èŠ‚æ€§æ¨¡å¼",
                    description: "å…¸å‹çš„å­£èŠ‚æ€§è¿›å±•ï¼Œæ—¶é—´ç¬¦åˆé¢„æœŸã€‚",
                    implications: [
                        "æ ‡å‡†æ°´æ–‡è¡Œä¸º",
                        "å¯é¢„æµ‹çš„æ¨¡å¼",
                        "å¸¸è§„ç®¡ç†ç­–ç•¥é€‚ç”¨"
                    ]
                }
            }
        };

        // ç”Ÿæˆä¸“ä¸šè§£è¯»
        function generateInterpretation() {
            const trendDirection = document.getElementById('trendDirection').value;
            const trendMagnitude = parseFloat(document.getElementById('trendMagnitude').value);
            const seasonalPattern = document.getElementById('seasonalPattern').value;
            const anomalyScore = parseFloat(document.getElementById('anomalyScore').value);
            const forecastConfidence = parseFloat(document.getElementById('forecastConfidence').value);

            // ç¡®å®šè¶‹åŠ¿å¼ºåº¦
            let trendStrength = "weak";
            if (Math.abs(trendMagnitude) > 20) {
                trendStrength = "strong";
            } else if (Math.abs(trendMagnitude) > 10) {
                trendStrength = "moderate";
            }

            const trendKey = `${trendStrength}_${trendDirection}`;
            const trendTemplate = interpretationTemplates.trend_analysis[trendKey] || 
                                interpretationTemplates.trend_analysis.stable;
            const seasonalTemplate = interpretationTemplates.seasonal_patterns[seasonalPattern] ||
                                   interpretationTemplates.seasonal_patterns.normal;

            // ç”Ÿæˆè§£è¯»ç»“æœ
            const interpretation = {
                trend: {
                    title: trendTemplate.title,
                    description: trendTemplate.description,
                    magnitude: `${Math.abs(trendMagnitude).toFixed(1)}%`,
                    implications: trendTemplate.implications
                },
                seasonal: {
                    title: seasonalTemplate.title,
                    description: seasonalTemplate.description,
                    implications: seasonalTemplate.implications
                },
                anomaly: {
                    score: anomalyScore,
                    severity: Math.abs(anomalyScore) > 2.0 ? "æç«¯" : 
                             Math.abs(anomalyScore) > 1.0 ? "ä¸­ç­‰" : "æ­£å¸¸",
                    description: Math.abs(anomalyScore) > 2.0 ? 
                        "SWEå€¼æç«¯å¼‚å¸¸ï¼Œä»£è¡¨åç¦»æ­£å¸¸æ¡ä»¶çš„æ˜¾è‘—ç¨‹åº¦ã€‚" : 
                        "SWEå€¼åœ¨æ­£å¸¸èŒƒå›´å†…ï¼Œè¡¨æ˜å…¸å‹çš„å†¬å­£æ¡ä»¶ã€‚"
                },
                forecast: {
                    confidence: forecastConfidence,
                    level: forecastConfidence > 0.8 ? "é«˜" : 
                           forecastConfidence > 0.6 ? "ä¸­" : "ä½",
                    description: forecastConfidence > 0.8 ?
                        "åŸºäºä¸€è‡´çš„æ¨¡å‹æ€§èƒ½å’Œç¨³å®šæ¡ä»¶çš„é«˜ç½®ä¿¡åº¦é¢„æµ‹ã€‚" :
                        "ç”±äºä¸ç¡®å®šæ€§å’Œå¯å˜æ¡ä»¶å¯¼è‡´çš„ä½ç½®ä¿¡åº¦é¢„æµ‹ã€‚"
                }
            };

            displayInterpretationResults(interpretation);
        }

        // æ˜¾ç¤ºè§£è¯»ç»“æœ
        function displayInterpretationResults(interpretation) {
            const container = document.getElementById('interpretationResults');
            
            const recommendations = generateRecommendations(interpretation);
            
            container.innerHTML = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">${interpretation.trend.magnitude}</div>
                        <div class="metric-label">è¶‹åŠ¿å˜åŒ–å¹…åº¦</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${interpretation.anomaly.severity}</div>
                        <div class="metric-label">å¼‚å¸¸ä¸¥é‡ç¨‹åº¦</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${interpretation.forecast.level}</div>
                        <div class="metric-label">é¢„æµ‹ç½®ä¿¡åº¦</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${interpretation.anomaly.score.toFixed(1)}</div>
                        <div class="metric-label">å¼‚å¸¸åˆ†æ•°</div>
                    </div>
                </div>

                <div class="interpretation-card">
                    <h3>ğŸ“ˆ ${interpretation.trend.title}</h3>
                    <p>${interpretation.trend.description}</p>
                    <p><strong>å˜åŒ–å¹…åº¦:</strong> ${interpretation.trend.magnitude}</p>
                    <p><strong>æ°´æ–‡å­¦å½±å“:</strong></p>
                    <ul>
                        ${interpretation.trend.implications.map(imp => `<li>${imp}</li>`).join('')}
                    </ul>
                </div>

                <div class="interpretation-card">
                    <h3>ğŸŒŠ ${interpretation.seasonal.title}</h3>
                    <p>${interpretation.seasonal.description}</p>
                    <p><strong>å­£èŠ‚æ€§å½±å“:</strong></p>
                    <ul>
                        ${interpretation.seasonal.implications.map(imp => `<li>${imp}</li>`).join('')}
                    </ul>
                </div>

                <div class="interpretation-card">
                    <h3>âš ï¸ å¼‚å¸¸è¯„ä¼°</h3>
                    <p>${interpretation.anomaly.description}</p>
                    <p><strong>å¼‚å¸¸ç¨‹åº¦:</strong> ${interpretation.anomaly.severity} (åˆ†æ•°: ${interpretation.anomaly.score.toFixed(2)})</p>
                </div>

                <div class="interpretation-card">
                    <h3>ğŸ¯ é¢„æµ‹å¯é æ€§</h3>
                    <p>${interpretation.forecast.description}</p>
                    <p><strong>ç½®ä¿¡åº¦æ°´å¹³:</strong> ${interpretation.forecast.level} (${(interpretation.forecast.confidence * 100).toFixed(0)}%)</p>
                </div>

                <div class="recommendations">
                    <h4>ğŸ”§ ç®¡ç†å»ºè®®</h4>
                    <ul>
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // ç”Ÿæˆç®¡ç†å»ºè®®
        function generateRecommendations(interpretation) {
            const recommendations = [];
            const trendMagnitude = parseFloat(interpretation.trend.magnitude);
            
            // åŸºäºè¶‹åŠ¿çš„å»ºè®®
            if (trendMagnitude > 10) {
                recommendations.push("ç›‘æ§æ´ªæ°´é˜²æŠ¤åŸºç¡€è®¾æ–½èƒ½åŠ›");
                recommendations.push("æ›´æ–°æ´ªæ°´é£é™©è¯„ä¼°å’Œåº”æ€¥è®¡åˆ’");
                recommendations.push("è€ƒè™‘å˜åŒ–æ¡ä»¶çš„é€‚åº”æ€§ç®¡ç†ç­–ç•¥");
            } else if (trendMagnitude < -10) {
                recommendations.push("è¯„ä¼°å¤å­£æœˆä»½çš„æ°´èµ„æºå¯ç”¨æ€§");
                recommendations.push("ç›‘æ§å¹²æ—±æŒ‡æ ‡å’Œå†œä¸šå½±å“");
                recommendations.push("è€ƒè™‘èŠ‚æ°´å’Œæ•ˆç‡æªæ–½");
            }

            // åŸºäºå¼‚å¸¸çš„å»ºè®®
            if (interpretation.anomaly.severity === "æç«¯") {
                recommendations.push("å®æ–½å¢å¼ºç›‘æµ‹å’Œæ—©æœŸé¢„è­¦ç³»ç»Ÿ");
                recommendations.push("å‡†å¤‡åº”æ€¥å“åº”åè®®");
                recommendations.push("å‘åˆ©ç›Šç›¸å…³è€…å’Œå…¬ä¼—ä¼ è¾¾é£é™©");
            } else if (interpretation.anomaly.severity === "ä¸­ç­‰") {
                recommendations.push("å¢åŠ ç›‘æµ‹é¢‘ç‡");
                recommendations.push("å®¡æŸ¥å’Œæ›´æ–°å“åº”è®¡åˆ’");
                recommendations.push("ä¸ºæ½œåœ¨æç«¯äº‹ä»¶åšå‡†å¤‡");
            }

            // åŸºäºé¢„æµ‹ç½®ä¿¡åº¦çš„å»ºè®®
            if (interpretation.forecast.confidence < 0.6) {
                recommendations.push("ä½¿ç”¨é›†åˆé¢„æµ‹æ–¹æ³•");
                recommendations.push("å®æ–½å¤šæƒ…æ™¯è§„åˆ’");
                recommendations.push("åœ¨å“åº”ç­–ç•¥ä¸­ä¿æŒçµæ´»æ€§");
            }

            // é€šç”¨å»ºè®®
            recommendations.push("ç»´æŒå®šæœŸæ•°æ®è´¨é‡è¯„ä¼°");
            recommendations.push("ç”¨æ–°è§‚æµ‹æ›´æ–°æ¨¡å‹");
            recommendations.push("ä¸åŒºåŸŸæ°´ç®¡ç†æœºæ„åè°ƒ");

            return recommendations;
        }

        // æ˜¾ç¤ºçŸ¥è¯†åº“å†…å®¹
        function displayKnowledge() {
            const category = document.getElementById('knowledgeCategory').value;
            const knowledge = hydrologyKnowledge[category];
            const container = document.getElementById('knowledgeDisplay');

            if (!knowledge) {
                container.innerHTML = '<div class="error">æœªæ‰¾åˆ°è¯¥ç±»åˆ«çš„çŸ¥è¯†å†…å®¹</div>';
                return;
            }

            let html = `<h3>${knowledge.title}</h3>`;

            function renderContent(content, level = 0) {
                let result = '';
                const indent = '  '.repeat(level);
                
                for (const [key, value] of Object.entries(content)) {
                    if (typeof value === 'string') {
                        result += `<p><strong>${key}:</strong> ${value}</p>`;
                    } else if (Array.isArray(value)) {
                        result += `<p><strong>${key}:</strong></p><ul>`;
                        value.forEach(item => {
                            result += `<li>${item}</li>`;
                        });
                        result += '</ul>';
                    } else if (typeof value === 'object') {
                        result += `<h4>${key}</h4>`;
                        result += renderContent(value, level + 1);
                    }
                }
                return result;
            }

            html += renderContent(knowledge.content);
            container.innerHTML = html;
        }

        // æµ‹è¯•API
        async function testAPI() {
            const endpoint = document.getElementById('apiEndpoint').value;
            const container = document.getElementById('apiResults');
            
            container.innerHTML = '<div class="loading">æ­£åœ¨è°ƒç”¨API...</div>';

            // æ¨¡æ‹ŸAPIè°ƒç”¨
            setTimeout(() => {
                const mockApiData = {
                    glossary: {
                        title: "æ°´æ–‡å­¦æŠ€æœ¯è¯æ±‡è¡¨",
                        data: {
                            "SWE": "é›ªæ°´å½“é‡ - èåŒ–é›ªäº§ç”Ÿçš„æ°´æ·±",
                            "åº¦æ—¥": "åŸºäºæ¸©åº¦çš„èé›ªå»ºæ¨¡æŒ‡æ ‡",
                            "æ¸—é€": "æ°´ä»è¡¨é¢è¿›å…¥åœŸå£¤çš„è¿‡ç¨‹",
                            "å¾„æµ": "æµè¿‡é™†åœ°è¡¨é¢åˆ°æ²³æµçš„æ°´",
                            "åŸºæµ": "æ¥è‡ªåœ°ä¸‹æ°´æºçš„æŒç»­æ²³æµæµé‡",
                            "å³°å€¼æµé‡": "æ´ªæ°´äº‹ä»¶æœŸé—´çš„æœ€å¤§æ’æ”¾é‡"
                        }
                    },
                    "climate-context": {
                        title: "æ°”å€™å˜åŒ–èƒŒæ™¯ä¿¡æ¯",
                        data: {
                            global_trends: "å…¨çƒå˜æš–æ¯”å·¥ä¸šåŒ–å‰æ°´å¹³é«˜1.1Â°C",
                            precipitation_changes: "é™æ°´å˜åŒ–æ€§å¢åŠ ï¼Œæç«¯äº‹ä»¶å¢å¤š",
                            manitoba_specific: {
                                temperature_increase: "åˆ°2050å¹´é¢„è®¡å‡æ¸©2-4Â°C",
                                precipitation_changes: "å†¬å­£å¢åŠ 10-20%ï¼Œå¤å­£å˜åŒ–æ›´å¤§",
                                snow_season: "é¢„è®¡åˆ°2050å¹´é›ªå­£ç¼©çŸ­2-4å‘¨"
                            }
                        }
                    },
                    "regional-info": {
                        title: "æ›¼å°¼æ‰˜å·´çœåŒºåŸŸä¿¡æ¯",
                        data: {
                            climate_zones: {
                                southern: "å¤§é™†æ€§æ°”å€™çš„è‰åŸåœ°åŒº",
                                central: "æ··åˆæ£®æ—çš„è¿‡æ¸¡å¸¦",
                                northern: "äºšåŒ—ææ°”å€™çš„åŒ—æ–¹æ£®æ—"
                            },
                            major_rivers: {
                                red_river: {
                                    length: "880 km",
                                    drainage_area: "116,500 kmÂ²",
                                    flow_regime: "èé›ªä¸»å¯¼ï¼Œæ˜¥å­£æ´ªå³°"
                                }
                            }
                        }
                    }
                };

                const data = mockApiData[endpoint];
                if (data) {
                    let html = `<h3>${data.title}</h3>`;
                    
                    function renderApiData(obj, level = 0) {
                        let result = '';
                        for (const [key, value] of Object.entries(obj)) {
                            if (typeof value === 'string') {
                                result += `<p><strong>${key}:</strong> ${value}</p>`;
                            } else if (typeof value === 'object') {
                                result += `<h${Math.min(4 + level, 6)}>${key}</h${Math.min(4 + level, 6)}>`;
                                result += renderApiData(value, level + 1);
                            }
                        }
                        return result;
                    }

                    html += renderApiData(data.data);
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div class="error">APIæ•°æ®æœªæ‰¾åˆ°</div>';
                }
            }, 1500);
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('HydrAI-SWE æ°´æ–‡çŸ¥è¯†åº“ç³»ç»Ÿæ¼”ç¤ºé¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>
